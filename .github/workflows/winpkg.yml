name: Windows Release

on:
  push:
    branches: [ "main" ]

jobs:
  publish-windows:
    name: Update Windows Package Manager repository
    runs-on: windows-latest
    environment: Release
    env:
      RELEASE_VER: '0.4.7'
      PACKAGE_URL: "https://github.com/scarvalhojr/aoc-cli/releases/download/0.4.7/aoc-cli-0.4.7-x86_64.msi"
      GITHUB_TOKEN: ${{ secrets.GH_ACCESS_TOKEN }}
    steps:
      - name: Run wingetcreate
        shell: powershell
        run: |
          # Install WingetCreate
          winget install Microsoft.WingetCreate

          wingetcreate update scarvalhojr.aoc-cli -urls ${env:PACKAGE_URL} -version ${env:RELEASE_VER} --token ${env:GITHUB_TOKEN} --submit
